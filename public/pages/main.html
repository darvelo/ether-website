<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="/public/vendor/styles/normalize.css" />
        <link rel="stylesheet" href="/public/vendor/styles/font-awesome.min.css" />
        <link rel="stylesheet" href="/public/vendor/styles/gruvbox-dark.css" />
        <link id="main-css" rel="stylesheet" href="/public/styles/main.css" />
        <link rel="stylesheet" href="/public/styles/app.css" />
        <title>Ether</title>
    </head>
    <body>
        <section id="main" role="main"></section>
        <script src="/public/vendor/scripts/ether.global.js"></script>
        <script src="/public/scripts/utils.js"></script>
        <script src="/public/scripts/main.js"></script>
        <script>
            window.addEventListener('load', function() {
                var ws = new WebSocket("ws://localhost:9001/");
                ws.onmessage = function(e) {
                    if (e.data === 'reloadCSS') {
                        var el = document.getElementById('main-css')
                        var href = el.getAttribute('href');
                        if (href.indexOf('?') !== -1) {
                            href = href.split('?')[0];
                        }
                        el.setAttribute('href', href + '?t=' + Date.now());
                    }
                };
            }, false);

            function all(event, promise) {
                var self = this;
                promise.then(function() {
                    console.log('good url', self.fullUrl());
                }, function(err) {
                    console.log('bad url', self.fullUrl(), err);
                });
            }
            var mainApp = new MainApp({
                debug: true,
                history: all,
                windowLoad: all,
                interceptLinks: all,
                outlets: {
                    main: new Ether.MutableOutlet(document.getElementById('main')),
                },
            }).start();
        </script>
        <script src="/public/vendor/scripts/highlight.pack.js"></script>
        <script>
            if (!window.Worker) {
                hljs.initHighlightingOnLoad();
            }
        </script>
    </body>
</html>
