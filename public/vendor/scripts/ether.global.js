/* Ether version 0.0.0 */
!function(e){"use strict";function t(e,t){return("Undefined"!==t&&"undefined"!=typeof t||"undefined"!=typeof e)&&("Null"!==t&&null!==t||null!==e)?{}.toString.call(e).slice(8,-1)===t:!0}function r(e,r){return!t(e,r)}function n(e){return Object.getPrototypeOf(e).constructor.name}function a(e){return P(S(e),function(t,r){return t[r]=C(e,r),t},{})}function s(e,t){if(r(t,"Function")&&r(t,null))throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":f._typeof(t)));e.prototype=j(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,n,o,i){if(t(e,"Null")&&(e=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];n.apply(this,t)}),r(e,"Function"))throw new TypeError("inherits(): subClass was not a function or null: "+JSON.stringify(e)+".");if(r(n,"Function"))throw new TypeError("inherits(): superClass was not a function: "+JSON.stringify(n)+".");return s(e,n),t(o,"Object")&&Object.defineProperties(e.prototype,a(o)),t(i,"Object")&&Object.defineProperties(e,a(i)),e}function i(e,r){var n=e.addressesHandlers();e._addressHandlers={},r.forEach(function(r,a){e._rootApp._registerAddress(r,e);var s=n[a];t(s,"String")&&(s=e[s]),e._addressHandlers[r]=s})}function u(e,t){for(var r=e.length,n=e,a=new Array(r),s=void 0,o=1;r>o;o<<=1){for(var i=0;r>i;i+=o<<1){var u=i,l=Math.min(r,i+o),p=Math.min(r,i+(o<<1));c(n,a,u,l,p,t)}s=n,n=a,a=s}if(e!==n)for(var h=0;r>h;++h)e[h]=n[h]}function c(e,t,r,n,a,s){for(var o=r,i=n,u=r;a>u;)n>o&&(i>=a||s(e[o],e[i])<=0)?t[u++]=e[o++]:t[u++]=e[i++]}function l(e,t,r){throw new TypeError("diffObjects(): argument "+e+' had a property "'+t+'" that was not a number, string, or boolean: '+JSON.stringify(r)+".")}function p(e,t){if(r(e,"Object")||r(t,"Object"))throw new TypeError("diffObjects(): was not passed two objects.");var n={},a=!1,s={};for(var o in e)if(e.hasOwnProperty(o)){n[o]=!0;var i=e[o];r(i,"Number")&&r(i,"String")&&r(i,"Boolean")&&l(1,o,i);var u=t[o];t.hasOwnProperty(o)&&r(u,"Number")&&r(u,"String")&&r(u,"Boolean")&&l(2,o,u),i!==u&&(a=!0,s[o]=[i,u])}for(var o in t)if(!n[o]&&t.hasOwnProperty(o)){var u=t[o];r(u,"Number")&&r(u,"String")&&r(u,"Boolean")&&l(2,o,u);var i=e[o];i!==u&&(a=!0,s[o]=[i,u])}return a?s:null}function h(e,r){return t(e,"Null")&&t(r,"Null")?null:{params:e,queryParams:r}}function d(e){var n=void 0,a=void 0;if(r(e,"Object"))throw new TypeError("makeOutlet(): Did not receive an object.");if(t(e.el,"Undefined")&&t(e.tagName,"Undefined"))throw new Error("makeOutlet(): Needs to receive an object with either of these two properties: el, or tagName.");if(r(e.el,"Undefined")&&r(e.tagName,"Undefined"))throw new Error("makeOutlet(): Needs to receive an object with either of these two properties, but the object had both: el, or tagName.");if(r(e.el,"Undefined")){if(!(e.el instanceof Element))throw new TypeError("makeOutlet(): Property `el` was not an instance of Element.");n=e.el}if(r(e.tagName,"Undefined")){if(r(e.tagName,"String"))throw new TypeError("makeOutlet(): Property `tagName` was not a string.");n=document.createElement(e.tagName)}if(t(e.classNames,"Array")){var s;(s=n.classList).add.apply(s,f.toConsumableArray(e.classNames))}return a=e.mutable===!0?new B(n):new b(n),r(e.append,"Undefined")&&(r(e.append,"Array")&&(e.append=[e.append]),e.append.forEach(function(e){if(e instanceof Element)n.appendChild(e);else{if(!(e instanceof b))throw new TypeError("makeOutlet(): Tried to append a value to the outlet's element that was neither an Outlet nor another HTML Element.");if(!(e._element instanceof Element))throw new Error("makeOutlet(): Tried to append an Outlet that was not holding HTML Element.");n.appendChild(e._element)}})),a}var f={};f._typeof=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},f.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},f.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},f.slicedToArray=function(){function e(e,t){var r=[],n=!0,a=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(u){a=!0,s=u}finally{try{!n&&i["return"]&&i["return"]()}finally{if(a)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f.toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)};var m,v,y=function(){function e(){f.classCallCheck(this,e)}return f.createClass(e,null,[{key:"transform",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return e._argsTransformFns.push(function(e){var t=e[0];return t.addresses=r,e}),e}}]),e}(),g=function(){function e(){f.classCallCheck(this,e)}return f.createClass(e,null,[{key:"transform",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];e.outlets=r}}]),e}(),w=function(){function e(){f.classCallCheck(this,e)}return f.createClass(e,null,[{key:"transform",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return e._argsTransformFns.push(function(e){var t=e[0];return t.setup=r.reduce(function(e,t){return t(e)},void 0),e}),e}}]),e}(),_=function(){function e(t,r){f.classCallCheck(this,e),this.klass=t,this._argsTransformFns=[];for(var n=arguments.length,a=Array(n>2?n-2:0),s=2;n>s;s++)a[s-2]=arguments[s];this._transform.apply(this,[r].concat(a))}return f.createClass(e,[{key:"_transform",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];e.transform.apply(e,[this].concat(r))}},{key:"create",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return r=this._argsTransformFns.reduce(function(e,t){return t(e)},r),(e=this.klass).create.apply(e,f.toConsumableArray(r))}},{key:"addresses",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this._transform.apply(this,[y].concat(t)),this}},{key:"outlets",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this._transform.apply(this,[g].concat(t)),this}},{key:"setup",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this._transform.apply(this,[w].concat(t)),this}}]),e}(),b=function(){function e(r){if(f.classCallCheck(this,e),t(r,"String")){var a=document.createElement("div");a.innerHTML=r,r=a.children[0]}if(!(r instanceof Element))throw new TypeError(n(this)+' constructor was not passed an "Element" instance.');this._element=r}return f.createClass(e,[{key:"empty",value:function(){this._element&&(this._element.innerHTML="")}},{key:"append",value:function(e){if(!(e instanceof Element))throw new TypeError(n(this)+'#append() was not passed an "Element" instance.');if(!this._element)throw new Error(n(this)+"#append() was called but the outlet is not holding an element.");this._element.appendChild(e)}},{key:"remove",value:function(e){if(!(e instanceof Element))throw new TypeError(n(this)+'#remove() was not passed an "Element" instance.');if(!this._element)throw new Error(n(this)+"#remove() was called but the outlet is not holding an element.");this._element.removeChild(e)}},{key:"querySelector",value:function(e){if(!this._element)throw new Error(n(this)+"#querySelector() was called but the outlet is not holding an element.");return this._element.querySelector(e)}},{key:"querySelectorAll",value:function(e){if(!this._element)throw new Error(n(this)+"#querySelectorAll() was called but the outlet is not holding an element.");return this._element.querySelectorAll(e)}},{key:"innerHTML",get:function(){return this._element.innerHTML},set:function(e){throw new Error(n(this)+".innerHTML cannot be set. Try using a MutableOutlet instead.")}}]),e}(),k=1,A=2,E=3,O=4,M=function(){function e(t){if(f.classCallCheck(this,e),r(t,"Object"))throw new TypeError(n(this)+" constructor was not given an options object.");this._checkAddresses(t.addresses),this._checkOutlets(t.outlets),this._checkParams(t.params),this._checkSetup(t.setup)}return f.createClass(e,[{key:"expectedAddresses",value:function(){throw new Error(n(this)+" did not implement expectedAddresses().")}},{key:"addressesHandlers",value:function(){throw new Error(n(this)+" did not implement addressesHandlers().")}},{key:"expectedOutlets",value:function(){throw new Error(n(this)+" did not implement expectedOutlets().")}},{key:"expectedParams",value:function(){throw new Error(n(this)+" did not implement expectedParams().")}},{key:"expectedSetup",value:function(e){throw new Error(n(this)+" did not implement expectedSetup().")}},{key:"_compareArrays",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];if(!Array.isArray(e))return k;if(!Array.isArray(t))return A;if(r){if(e.length!==t.length||e.slice().sort().join("")!==t.slice().sort().join(""))return E}else for(var n=e.reduce(function(e,t){return e[t]=!0,e},{}),a=0,s=t.length;s>a;++a){var o=t[a];if(!n[o])return O}return!0}},{key:"_checkAddressesHandlers",value:function(e){var a=this,s=this.addressesHandlers();if(!Array.isArray(s))throw new TypeError(n(this)+"#addressesHandlers() did not return an Array.");if(e.length!==s.length){var o=n(this);throw new Error([o,"#addressesHandlers() did not return the same number of handler functions as addresses returned by ",o,"#expectedAddresses()."].join(""))}var i=[],u=[];if(s.forEach(function(e){t(e,"String")&&r(a[e],"Function")&&i.push(e),r(e,"String")&&r(e,"Function")&&u.push(e)}),i.length)throw new Error([n(this),"#addressesHandlers() references member function(s) that do not exist: ",JSON.stringify(i),"."].join(""));if(u.length)throw new Error([n(this),"#addressesHandlers() returned non-function(s): ",JSON.stringify(u),"."].join(""))}},{key:"_checkAddresses",value:function(e){var t=this.expectedAddresses(),r=this._compareArrays(e,t);switch(r){case k:throw new TypeError(n(this)+" constructor's options.addresses property was not an Array.");case A:throw new TypeError(n(this)+"#expectedAddresses() did not return an Array.");case E:throw new Error([n(this),"'s received addresses ",JSON.stringify(e)," did not match its expected addresses ",JSON.stringify(t),"."].join(""))}if(e.some(function(e){return""===e}))throw new Error(n(this)+" received an address that was the empty string.");if(t.some(function(e){return""===e}))throw new Error(n(this)+" expected an address that was the empty string.");this._checkAddressesHandlers(t)}},{key:"_checkOutlets",value:function(e){if(r(e,"Object"))throw new TypeError(n(this)+" constructor's options.outlets property was not an Object.");var t=Object.keys(e).sort(),a=this.expectedOutlets(),s=this._compareArrays(t,a);switch(s){case A:throw new TypeError(n(this)+"#expectedOutlets() did not return an Array.");case E:throw new Error([n(this),"'s received outlets ",JSON.stringify(t)," did not match its expected outlets ",JSON.stringify(a),"."].join(""))}var o=[];if(t.forEach(function(t){e[t]instanceof b||o.push(t)}),o.length)throw new TypeError([n(this)," did not receive instances of Outlet for named outlets: ",JSON.stringify(o.sort()),"."].join(""))}},{key:"_checkParams",value:function(e){var t=this.expectedParams(),r=!1,a=this._compareArrays(e,t,r);switch(a){case k:throw new TypeError(n(this)+" constructor's options.params property was not an Array.");case A:throw new TypeError(n(this)+"#expectedParams() did not return an Array.");case O:throw new Error([n(this),"'s received params ",JSON.stringify(e)," did not fulfill its expected params ",JSON.stringify(t),"."].join(""));case E:throw new Error("Params given were not strictly equal to expected params. This error should never occur and is a bug. Please report this to the library developers.")}}},{key:"_checkSetup",value:function(e){this.expectedSetup(e)}}]),e}(),T=Function.call.bind(Function.bind,Function.call),P=Array.reduce||T(Array.prototype.reduce),C=Object.getOwnPropertyDescriptor,j=Object.create,S=function(e){return[].concat(f.toConsumableArray(Object.getOwnPropertyNames(e)),f.toConsumableArray(Object.getOwnPropertySymbols(e)))},N=function(e){function t(){return f.classCallCheck(this,t),f.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return f.inherits(t,e),f.createClass(t,null,[{key:"create",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(this,[null].concat(t)))}},{key:"extend",value:function(e,t){return o(null,this,e,t)}},{key:"addresses",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(_,[null].concat([this,y],t)))}},{key:"outlets",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(_,[null].concat([this,g],t)))}},{key:"setup",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(_,[null].concat([this,w],t)))}}]),t}(M),x=Object.freeze(["deactivating","deactivated","prerendering","prerendered","rendering","rendered"]),D=function(e){function t(e){f.classCallCheck(this,t);var r=f.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return Object.defineProperty(r,"state",{value:{},configurable:!1,enumerable:!0}),Object.defineProperties(r.state,x.reduce(function(e,t){return e[t]={value:!1,writable:!0,enumerable:!0},e},{})),Object.seal(r.state),r}return f.inherits(t,e),f.createClass(t,[{key:"_setOutletsState",value:function(e,t){if(!this.state.hasOwnProperty(e))throw new Error(n(this)+"#_setOutletsState(): Tried to set outlets state to an unsupported value: "+JSON.stringify(e)+".");var r=this.outlets,a="ether-",s=x.filter(function(r){return t&&"rendered"===r?!1:r!==e}).map(function(e){return a+e});e=a+e,Object.keys(r).forEach(function(t){var n;r[t]._element.classList.add(e),(n=r[t]._element.classList).remove.apply(n,f.toConsumableArray(s))})}},{key:"_setState",value:function(e){var t=this;if(!this.state.hasOwnProperty(e))throw new Error(n(this)+"#_setState(): Tried to set state to an unsupported value: "+JSON.stringify(e)+".");var r=void 0;switch(e){case"prerendering":case"prerendered":case"rendering":this.state.rendered===!0&&(r=!0)}x.forEach(function(r){e===r?t.state[r]=!0:t.state[r]=!1}),r&&(this.state.rendered=!0),this._setOutletsState(e,r)}},{key:"_deactivate",value:function(){var e=this;return Promise.resolve().then(function(){return e._setState("deactivating"),e.deactivate()}).then(function(){e._setState("deactivated")},function(t){e._setState("deactivated"),e._rootApp._config.debugMode&&(console.warn(n(e)+"#deactivate() triggered an error:"),console.warn(t))})}},{key:"_prerender",value:function(e,t,r){var a=this;return Promise.resolve().then(function(){return a._setState("prerendering"),a.prerender(e,t,r)}).then(function(){a._setState("prerendered")},function(e){a._setState("prerendered"),a._rootApp._config.debugMode&&(console.warn(n(a)+"#prerender() triggered an error:"),console.warn(e))})}},{key:"_render",value:function(e,t,r){var a=this;return Promise.resolve().then(function(){return a._setState("rendering"),a.render(e,t,r)}).then(function(){a._setState("rendered")},function(e){a._setState("rendered"),a._rootApp._config.debugMode&&(console.warn(n(a)+"#render() triggered an error:"),console.warn(e))})}},{key:"deactivate",value:function(){}},{key:"prerender",value:function(e,t,r){}},{key:"render",value:function(e,t,r){}}]),t}(N),F=function(){function e(){f.classCallCheck(this,e)}return f.createClass(e,[{key:"_compileMountOutlets",value:function(e,t,r,a){var s=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],o=[],i={},u=s?"conditional ":"";if(e instanceof _&&Array.isArray(e.outlets)&&(e.outlets.forEach(function(e){var t=a.outlets[e];t?i[e]=t:o.push(e)}),o.length)){var c=n(a.parentApp);throw new Error(c+" "+u+'mount "'+t+'" requested these outlets that '+c+" does not own: "+JSON.stringify(o)+".")}return this._addToPassedOutletsList(i,r,a.parentApp),i}},{key:"_addToPassedOutletsList",value:function(e,t,r){var a=[];for(var s in e)t.hasOwnProperty(s)?a.push(s):t[s]=!0;if(a.length)throw new Error([n(r)," tried to send these outlets to more than one mount: ",JSON.stringify(a.sort()),"."].join(""))}}]),e}(),R=function(e){function t(e){f.classCallCheck(this,t);var r=f.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));if(!e.rootApp)throw new TypeError(n(r)+" constructor was not given a reference to the Ether RootApp.");if(!e.parentApp)throw new TypeError(n(r)+" constructor was not given a reference to its parentApp.");return r._rootApp=e.rootApp,r._parentApp=e.parentApp,r.addresses=e.addresses,i(r,r.addresses),r.outlets=e.outlets,r._setState("deactivated"),r._rootApp._inits.push(function(){return r.init(e.setup)}),r}return f.inherits(t,e),f.createClass(t,[{key:"init",value:function(e){}},{key:"expectedAddresses",value:function(){return[]}},{key:"addressesHandlers",value:function(){return[]}},{key:"expectedParams",value:function(){return[]}},{key:"expectedSetup",value:function(e){}},{key:"navigate",value:function(){var e;return(e=this._rootApp).navigate.apply(e,arguments)}},{key:"canNavigateTo",value:function(){var e;return(e=this._rootApp).canNavigateTo.apply(e,arguments)}},{key:"linkTo",value:function(){var e;return(e=this._rootApp).linkTo.apply(e,arguments)}},{key:"sendTo",value:function(){var e;return(e=this._rootApp).sendTo.apply(e,arguments)}}]),t}(D),L=function(e){function a(){f.classCallCheck(this,a);for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=f.possibleConstructorReturn(this,(m=Object.getPrototypeOf(a)).call.apply(m,[this].concat(f.toConsumableArray(t))));return n._crumbMap={},n._sortedCrumbs=[],n._mountsAdded=!1,n._currentMount=null,n._lastParams={},n}return f.inherits(a,e),f.createClass(a,[{key:"_sortFn",value:function(e,t){return t.slashes-e.slashes}},{key:"mountsAdded",value:function(){return this._mountsAdded}},{key:"parse",value:function(e){var t=1,r=2,n=3,a=t,s=e.length,o=[],i=[],u={},c=0,l=0,p=0,h=0,d=!1,f={"/":"\\/","\\":"\\\\","[":"\\[","]":"\\]","(":"\\(",")":"\\)"};for(o.push("^\\/?"),s&&"/"===e[0]&&(l=c=1);s>l;++l){var m=e[l];if(a===t){var v=!1,y=!1;"{"===m?(a=r,v=!0):f[m]&&("/"===m&&h++,v=!0,y=!0),v&&(o.push(e.slice(c,l)),c=l+1),y&&o.push(f[m])}else if(a===r){if("="===m){a=n;var g=e.slice(c,l);if(u.hasOwnProperty(g))throw new RangeError('MountMapper: Parameter name "'+g+'" was given more than once in breadcrumb '+e);u[g]=!0,i.push(g),o.push("("),c=l+1}else if(f[m]||"{"===m||"}"===m)throw new Error('Ether MountMapper: The "'+m+'" character is not allowed in a parameter name. Breadcrumb given was '+e)}else if(a===n)if("^"===m&&"["===e[l-1])d=!0;else if("]"===m)d=!1;else{if("/"===m&&!d)throw new Error('Ether MountMapper: The "/" character is not allowed in the regex of a parameter value, unless it is part of a negated character class. Breadcrumb given was '+e);if("("===m&&"\\"!==e[l-1]){var w=e.slice(l,l+3);if("(?:"!==w&&"(?="!==w&&"(?!"!==w)throw new Error("Ether MountMapper: Capturing groups are not allowed in the regex of a parameter value. Breadcrumb given was "+e)}else{if("."===m)throw new Error('Ether MountMapper: The "." character is not allowed in the regex of a parameter value. Breadcrumb given was '+e);"{"===m?p++:"}"===m&&(p?p--:(a=t,o.push(e.slice(c,l)),o.push(")"),c=l+1))}}}if(a!==t)throw new Error("Ether MountMapper: Malformed breadcrumb "+e);return l>c&&o.push(e.slice(c,l)),o.push("(.*)"),{regex:new RegExp(o.join("")),paramNames:i.length?i:null,slashes:h}}},{key:"_compileMountParams",value:function(e,t,r,a){var s=a.params,o={},i=Object.keys(s),u=[],c=[],l=void 0;if(l=e instanceof _?e.klass.prototype.expectedParams():e.prototype.expectedParams(),r.forEach(function(e){s[e]&&c.push(e),o[e]=!0,i.push(e)}),c.length)throw new Error([n(a.parentApp),' mount on "',t.replace("\\","\\\\"),'" declares parameter(s) that were already declared higher in the App chain: ',JSON.stringify(c),"."].join(""));if(l.forEach(function(e){s[e]||o[e]||u.push(e)}),u.length)throw u.sort(),new Error('MyApp#mount(): The following params were not available to "'+t+'": '+JSON.stringify(u)+".");return i}},{key:"_checkMountInheritance",value:function(e,t,r){e instanceof _&&(e=e.klass);var a=Object.create(e.prototype);if(!(a instanceof H||a instanceof R))throw new TypeError(n(r)+' mount "'+t+'" is not an instance of App or Route.')}},{key:"_instantiateMountInstance",value:function(e,t,r,n,a){this._checkMountInheritance(e,t,a.parentApp);var s={rootApp:a.rootApp,parentApp:a.parentApp,outlets:this._compileMountOutlets(e,t,n,a),params:this._compileMountParams(e,t,r,a),addresses:[]},o=e.create(s);return{instance:o,addresses:o.addresses||[]}}},{key:"add",value:function(e,t){if(this._mountsAdded)throw new Error(n(this)+"#add() can only be called once.");if(this._mountsAdded=!0,r(e,"Object"))throw new Error(n(this)+"#add() expected an object containing the mounts.");if(r(t,"Object"))throw new Error(n(this)+"#add() expected an object containing the mount's parent data.");if(!(t.rootApp instanceof H))throw new TypeError(n(this)+"#add() did not receive an App instance for parentData.rootApp.");if(!(t.parentApp instanceof H))throw new TypeError(n(this)+"#add() did not receive an App instance for parentData.parentApp.");if(r(t.outlets,"Object"))throw new TypeError(n(this)+"#add() did not receive an object for parentData.outlets.");if(r(t.params,"Array"))throw new TypeError(n(this)+"#add() did not receive an array for parentData.params.");var a={},s={};t.params=Object.freeze(t.params.reduce(function(e,t){return e[t]=!0,e},{}));for(var o in e)if(e.hasOwnProperty(o)){var i=e[o],c=this.parse(o),l=c.paramNames||[],p=this._instantiateMountInstance(i,o,l,a,t),h={crumb:o,mount:p.instance,addresses:p.addresses.length?p.addresses:null,regex:c.regex,paramNames:c.paramNames,slashes:c.slashes};h.addresses&&h.addresses.forEach(function(e){s[e]=!0}),this._sortedCrumbs.push(h),this._crumbMap[o]=h}return u(this._sortedCrumbs,this._sortFn),{addresses:s,outlets:a}}},{key:"match",value:function(e){for(var t=this._sortedCrumbs,r=void 0,n=void 0,a=void 0,s=void 0,o=0,i=t.length;i>o;++o)if(r=t[o],n=r.regex.exec(e)){if(s=n.length,a=n[s-1]||null,!(a&&r.mount instanceof R))break;n=null}if(!n)return null;var u=r.paramNames,c=u?u.length:0,l=r.crumb;if(s-c>2)throw new Error('Ether MountMapper: The number of parameters in the given path exceeded the amount given in the breadcrumb. This is likely a bug. Path was "'+e+'" and regex was '+r.regex.source);for(var p={crumb:l,rest:a,params:{}},o=0;c>o;++o){var h=n[o+1];h=decodeURIComponent(h),"true"===h?h=!0:"false"===h&&(h=!1),p.params[u[o]]=h}return p}},{key:"setCurrentMount",value:function(e,n){if(t(e,"Null"))return void(this._currentMount=null);if(r(e,"String"))throw new TypeError("MountMapper#setCurrentMount(): The first argument given was not a string: "+JSON.stringify(e)+".");if(t(n,"Null"))n={};else if(r(n,"Object"))throw new TypeError("MountMapper#setCurrentMount(): The second argument given was not an object or null: "+JSON.stringify(n)+".");var a=this._crumbMap[e];if(!a)throw new Error('MountMapper#setCurrentMount(): The breadcrumb "'+e+'" was not added to this MountMapper.');var s=a.mount.expectedParams();if(s.forEach(function(t){if(!n.hasOwnProperty(t))throw new Error('MountMapper#setCurrentMount(): The params given for breadcrumb "'+e+'" did not match its expected params.')}),s.length!==Object.keys(n).length)throw new Error('MountMapper#setCurrentMount(): The params given for breadcrumb "'+e+'" exceeded its expected params.');this._currentMount=e,this._lastParams[e]=Object.assign({},n)}},{key:"getCurrentMount",value:function(){return this._currentMount}},{key:"allMounts",value:function(){return this._sortedCrumbs}},{key:"allAddresses",value:function(){return this._sortedCrumbs.reduce(function(e,t){return t.addresses.forEach(function(t){return e.push(t)}),e},[]).sort()}},{key:"addressesFor",value:function(e){var t=this._crumbMap[e];return t&&(t.addresses||[])}},{key:"mountFor",value:function(e){var t=this._crumbMap[e];return t&&t.mount}},{key:"regexFor",value:function(e){var t=this._crumbMap[e];return t&&t.regex}},{key:"paramNamesFor",value:function(e){var t=this._crumbMap[e];return t&&(t.paramNames||[])}},{key:"lastParamsFor",value:function(e){return this._lastParams[e]}},{key:"slashesFor",value:function(e){var t=this._crumbMap[e];return t&&t.slashes}},{key:"_crumbDataFor",value:function(e){return this._sortedCrumbs.find(function(t){return t.mount===e})}}]),a}(F),J=function(e){function a(){f.classCallCheck(this,a);for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=f.possibleConstructorReturn(this,(v=Object.getPrototypeOf(a)).call.apply(v,[this].concat(f.toConsumableArray(t))));return n._acceptedOperators=["*","+","!"],n._mounts={},n._mountsAdded=!1,n._currentMounts=null,n._lastParams={},n}return f.inherits(a,e),f.createClass(a,[{key:"parse",value:function(e){var t=e[0];if(-1===this._acceptedOperators.indexOf(t))throw new Error(n(this)+" only supports the initial character being one of this list: "+JSON.stringify(this._acceptedOperators)+".");var r=e.slice(1);if(r)r=r.split(",");else{if("*"!==t)throw new Error('Conditional mounts that are not "*" require a comma-delimited list of required addresses.');r=[]}if(r.some(function(e){return""===e}))throw new Error('ConditionalMountMapper#parse(): Empty addresses are not allowed in conditional mount: "'+e+'".');var a=void 0;switch(t){case"*":a=/.*/;break;case"+":a=new RegExp(["^(?:",r.join("|"),")$"].join(""));break;case"!":a=new RegExp(["^(?!",r.map(function(e){return e+"$"}).join("|"),").*"].join(""))}return{operator:t,logic:e,addresses:r,regex:a}}},{key:"_testParamByOperator",value:function(e,t,r){var n=e.operator,a=e.regex,s=e.addresses;switch(n){case"+":for(var o=0,i=s.length;i>o;++o){var u=s[o];if(!t[u][r])return!1}return!0;case"*":for(var u in t)if(t.hasOwnProperty(u)&&!t[u][r])return!1;return!0;case"!":for(var u in t)if(t.hasOwnProperty(u)&&a.test(u)&&!t[u][r])return!1;return!0;default:return!1}}},{key:"_compileMountParams",value:function(e,t,r){var n=this,a=r.params,s=r.addressesParams,o=[],i=[],u=void 0;if(u=e instanceof _?e.klass.prototype.expectedParams():e.prototype.expectedParams(),u.forEach(function(e){a[e]?i.push(e):n._testParamByOperator(t,s,e)?i.push(e):o.push(e)}),o.length)throw o.sort(),new Error('MyApp#mountConditionals(): Not every mount referenced in "'+t.logic+'" had these params available: '+JSON.stringify(o)+".");return i}},{key:"_checkMountInheritance",value:function(e,t,r){e instanceof _&&(e=e.klass);var a=Object.create(e.prototype);if(!(a instanceof R))throw new TypeError(n(r)+' conditional mount "'+t+'" is not an instance of Route or an array of Route instances.')}},{key:"_instantiateMountInstance",value:function(e,t,r,n){var a=t.logic,s=!0;this._checkMountInheritance(e,a,n.parentApp);var o={rootApp:n.rootApp,parentApp:n.parentApp,outlets:this._compileMountOutlets(e,a,r,n,s),params:this._compileMountParams(e,t,n),addresses:[]};return e.create(o)}},{key:"add",value:function(e,t){function a(e){return!i[e]}function s(e){return function(r){return o._instantiateMountInstance(r,e,u,t)}}if(this._mountsAdded)throw new Error(n(this)+"#add() can only be called once.");if(this._mountsAdded=!0,r(e,"Object"))throw new TypeError(n(this)+"#add() expected an object of mounts.");if(r(t,"Object"))throw new TypeError(n(this)+"#add() expected an object containing the mount's parent data.");if(r(t.mountsMetadata,"Object"))throw new TypeError(n(this)+"#add() did not receive an object for parentData.mountsMetadata.");if(r(t.mountsMetadata.addresses,"Object"))throw new TypeError(n(this)+"#add() did not receive an object for parentData.mountsMetadata.addresses.");if(r(t.mountsMetadata.outlets,"Object"))throw new TypeError(n(this)+"#add() did not receive an object for parentData.mountsMetadata.outlets.");if(!(t.mountMapper instanceof L))throw new TypeError(n(this)+"#add() did not receive an instance of MountMapper for parentData.mountMapper.");if(!(t.rootApp instanceof H))throw new TypeError(n(this)+"#add() did not receive an App instance for parentData.rootApp.");if(!(t.parentApp instanceof H))throw new TypeError(n(this)+"#add() did not receive an App instance for parentData.parentApp.");if(r(t.outlets,"Object"))throw new TypeError(n(this)+"#add() did not receive an object for parentData.outlets.");if(r(t.params,"Array"))throw new TypeError(n(this)+"#add() did not receive an array for parentData.params.");var o=this,i=t.mountsMetadata.addresses,u=t.mountsMetadata.outlets;t.params=Object.freeze(t.params.reduce(function(e,t){return e[t]=!0,e},{})),t.addressesParams=t.mountMapper.allMounts().reduce(function(e,t){var r={};return t.paramNames&&t.paramNames.forEach(function(e){return r[e]=!0}),t.addresses&&t.addresses.forEach(function(t){e[t]=r}),e},{});for(var c in e)if(e.hasOwnProperty(c)){var l=e[c];if(Array.isArray(l)||(l=[l]),0===l.length)throw new Error(n(this)+"#add() received an empty array for a mount.");var p=this.parse(c),h=p.addresses.filter(a).sort();if(h.length){var d=n(t.parentApp);throw new Error([d,"#mountConditionals() requires addresses that are not created in ",d,"#mount(): ",JSON.stringify(h),"."].join(""))}this._mounts[c]={operator:p.operator,regex:p.regex,mounts:l.map(s(p))}}}},{key:"match",value:function(e){var t=this,r={},n=function(n){if(!t._mounts.hasOwnProperty(n))return"continue";var a=t._mounts[n],s=a.operator,o=a.regex;e.length||(e=[""]),e.forEach(function(e){switch(s){case"*":r[n]=!0;break;case"+":o.test(e)&&(r[n]=!0);break;case"!":r[n]!==!1&&(o.test(e)?r[n]=!0:r[n]=!1)}})};for(var a in this._mounts){n(a)}for(var a in r)r.hasOwnProperty(a)&&r[a]===!1&&delete r[a];var s=!0;for(var a in r)if(r.hasOwnProperty(a)){s=!1;break}return s?null:r}},{key:"setCurrentMounts",value:function(e){var a=this;if(t(e,"Null"))return void(this._currentMounts=null);if(r(e,"Object"))throw new TypeError("ConditionalMountMapper#setCurrentMounts(): The first argument given was not an object: "+JSON.stringify(e)+".");var s=[],o=[];for(var i in e)e.hasOwnProperty(i)&&(this._mounts.hasOwnProperty(i)?o.push(i):s.push(i));if(s.length)throw new Error("ConditionalMountMapper#setCurrentMounts(): The following conditional mounts given were not added to this ConditionalMountMapper: "+JSON.stringify(s.sort())+".");o.forEach(function(t){var r=a._mounts[t].mounts;r.forEach(function(r,a){var s=e[t][a],o=r.expectedParams();if(o.forEach(function(e){if(!s.hasOwnProperty(e))throw new Error("ConditionalMountMapper#setCurrentMounts(): The params given for "+n(r)+" ("+JSON.stringify(s)+") did not match its expected params: "+JSON.stringify(o.sort())+".")}),o.length!==Object.keys(s).length)throw new Error("ConditionalMountMapper#setCurrentMounts(): The params given for "+n(r)+" ("+JSON.stringify(s)+") exceeded its expected params: "+JSON.stringify(o.sort())+".")})}),this._currentMounts=Object.keys(e).sort(),
this._lastParams=Object.assign(this._lastParams,JSON.parse(JSON.stringify(e)))}},{key:"getCurrentMounts",value:function(){return this._currentMounts}},{key:"lastParamsFor",value:function(e){return this._lastParams[e]}},{key:"routesFor",value:function(e){var t=this._mounts[e];return t&&t.mounts}}]),a}(F),H=function(e){function a(e){f.classCallCheck(this,a);var t=f.possibleConstructorReturn(this,Object.getPrototypeOf(a).call(this,e));if(!e.rootApp)throw new TypeError(n(t)+" constructor was not given a reference to the Ether RootApp.");if(e.rootApp!==t&&!e.parentApp)throw new TypeError(n(t)+" constructor was not given a reference to its parentApp.");return t._rootApp=e.rootApp,t._parentApp=e.parentApp,t.addresses=e.addresses,e.rootApp instanceof a&&t._buildAppTree(e),t}return f.inherits(a,e),f.createClass(a,[{key:"_buildAppTree",value:function(e){var t=this;i(this,this.addresses),this._mountMapper=new L,this._conditionalMountMapper=new J;var r=this.createOutlets(e.outlets),n=this._instantiateMounts(r,e.params);this._instantiateConditionalMounts(r,e.params,n),this._setState("deactivated"),this._rootApp._inits.push(function(){return t.init(e.setup)})}},{key:"mount",value:function(){return{}}},{key:"mountConditionals",value:function(){return{}}},{key:"navigate",value:function(){var e;return(e=this._rootApp).navigate.apply(e,arguments)}},{key:"canNavigateTo",value:function(){var e;return(e=this._rootApp).canNavigateTo.apply(e,arguments)}},{key:"linkTo",value:function(){var e;return(e=this._rootApp).linkTo.apply(e,arguments)}},{key:"sendTo",value:function(){var e;return(e=this._rootApp).sendTo.apply(e,arguments)}},{key:"init",value:function(e){}},{key:"createOutlets",value:function(e){return e}},{key:"expectedAddresses",value:function(){return[]}},{key:"addressesHandlers",value:function(){return[]}},{key:"expectedParams",value:function(){return[]}},{key:"expectedSetup",value:function(e){}},{key:"_instantiateMounts",value:function(e,a){var s=this,o=this.mount();if(r(o,"Object"))throw new TypeError(n(this)+"#mount() did not return an object.");if(this._rootApp._config.debugMode){var i=!0;for(var u in o)if(o.hasOwnProperty(u)){i=!1;break}i&&console.warn(n(this)+"#mount() returned an empty object.")}this.outlets=Object.assign({},e),Object.keys(o).forEach(function(e){var r=o[e];r instanceof _&&t(r.outlets,"Array")&&r.outlets.forEach(function(e){return delete s.outlets[e]})});var c={rootApp:this._rootApp,parentApp:this,outlets:e,params:a};return this._mountMapper.add(o,c)}},{key:"_instantiateConditionalMounts",value:function(e,a,s){var o=this,i=this.mountConditionals();if(r(i,"Object"))throw new TypeError(n(this)+"#mountConditionals() did not return an object.");Object.keys(i).forEach(function(e){var n=i[e];r(n,"Array")&&(n=[n]),n.forEach(function(e){e instanceof _&&t(e.outlets,"Array")&&e.outlets.forEach(function(e){return delete o.outlets[e]})})});var u={rootApp:this._rootApp,parentApp:this,outlets:e,mountMapper:this._mountMapper,params:a,mountsMetadata:s};this._conditionalMountMapper.add(i,u)}}]),a}(D),U=function(){function e(t,r,n){var a=this;f.classCallCheck(this,e),this._url=t,this._navigateOpts=r,this._navigateFn=n,this._state="pending",this._promise=new Promise(function(e,t){var r=[e,t];a._resolve=r[0],a._reject=r[1]})}return f.createClass(e,[{key:"start",value:function(){var e=this;return"pending"===this.state&&(this._state="started",this._navigateFn(this.url,this._navigateOpts).then(function(t){e._state="succeeded",e._resolve(t)},function(t){e._state="failed",e._reject(t)})),this.promise}},{key:"url",get:function(){return this._url}},{key:"state",get:function(){return this._state}},{key:"promise",get:function(){return this._promise}}]),e}(),I=function(){function e(){f.classCallCheck(this,e),this._inits=[],this._paused=!1;var t=void 0;this._promise=new Promise(function(e){return t=e}),this._resolve=t}return f.createClass(e,[{key:"then",value:function(){var e;return(e=this._promise).then.apply(e,arguments)}},{key:"push",value:function(){var e;(e=this._inits).push.apply(e,arguments)}},{key:"pause",value:function(){this._paused=!0}},{key:"play",value:function(){this._paused=!1,this.run()}},{key:"run",value:function(){this._paused||(this._inits.forEach(function(e){return e()}),this._resolve())}}]),e}(),q=function(e){function a(e){f.classCallCheck(this,a),r(e,"Object")&&(e={}),e.rootApp=!0,e.parentApp=!0,e.addresses=e.addresses||[],e.outlets=e.outlets||{},e.params=[];var n=f.possibleConstructorReturn(this,Object.getPrototypeOf(a).call(this,e));if(e.rootApp=n,t(e.basePath,"String")&&e.basePath.length){var s=e.basePath.length,o=[];"/"!==e.basePath[0]&&o.push("/"),o.push(e.basePath),1!==s&&"/"!==e.basePath[s-1]&&o.push("/"),e.basePath=o.join("")}else e.basePath="/";return e.basePath=encodeURI(e.basePath),n._rootApp=n,n._parentApp=null,n._inits=new I,e._pauseInitRunner===!0&&n._inits.pause(),n._config=Object.freeze({stripTrailingSlash:!!e.stripTrailingSlash||!1,addTrailingSlash:!!e.addTrailingSlash||!1,basePath:e.basePath,windowLoad:e.windowLoad||!1,history:e.history||!1,interceptLinks:e.interceptLinks||"none",debugMode:e.debug===!0}),n._fullUrl=void 0,n._lastParams=null,n._lastQueryParams=null,n._transitionQueue=[],n._currentTransition=null,n._buildAppTree(e),n._inits.run(),n}return f.inherits(a,e),f.createClass(a,[{key:"getCurrentTransition",value:function(){return this._currentTransition}},{key:"expectedAddresses",value:function(){return[]}},{key:"addressesHandlers",value:function(){return[]}},{key:"expectedOutlets",value:function(){return["main"]}},{key:"expectedParams",value:function(){return[]}},{key:"expectedSetup",value:function(e){}},{key:"_pushAnyMissingLinkToParams",value:function(e,t,n,a){r(t,"Array")||t.forEach(function(t){e.hasOwnProperty(a(t))||n.push(t)})}},{key:"_constructURLCrumb",value:function(e,t,r){return e.replace(/\{([^=]+)=[^}]+\}/g,function(e,n){return encodeURIComponent(t[r(n)])})}},{key:"_joinPath",value:function(e){if(r(e,"Array"))throw new TypeError(n(this)+"#_joinPath(): crumbs was not an array.");var a=e.reduce(function(e,t){r(e,"Array")&&(e=[e]);var n=e.length,a=e[n-1];return"/"===a[a.length-1]&&(e[n-1]=a.slice(0,-1)),"/"===t[0]&&(t=t.slice(1)),e.push(t),e});return t(a,"Array")&&(a=a.join("/")),a}},{key:"linkTo",value:function(e){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(r(e,"String"))throw new TypeError("Ether linkTo(): Address given was not a string.");if(r(a,"Object"))throw new TypeError("Ether linkTo(): Params given was not an object.");var o=this,i=o._atAddress(e);if(t(i,"Undefined"))throw new Error('Ether linkTo(): Address given was never registered: "'+e+'".');if(!(i instanceof R))throw new Error('Ether linkTo(): Address given does not refer to a Route instance: "'+e+'".');if(!i._parentApp._mountMapper._crumbDataFor(i))throw new Error('Ether linkTo(): Address given does not refer to a non-conditional Route instance: "'+e+'". Route was: '+n(i)+".");for(var u=[],c=!1,l=i,p=void 0;!c;){p=l._parentApp,p===o&&(c=!0);var h=p._mountMapper;u.push(h._crumbDataFor(l)),l=p}var d=void 0;d=t(s.transformer,"Function")?s.transformer:function(e){return e};for(var f=[],m=[];u.length;){var v=u.pop(),y=v.crumb,g=v.paramNames;this._pushAnyMissingLinkToParams(a,g,m,d),m.length||f.push(this._constructURLCrumb(y,a,d))}if(m.length)throw m=JSON.stringify(m.sort()),new Error('Ether linkTo(): Missing params for destination "'+n(i)+'" at address "'+e+'": '+m+".");var w=this._joinPath(f);if(!o.canNavigateTo(w))throw new Error('Ether linkTo(): Navigation to "'+n(i)+'" at address "'+e+'" will fail for constructed URL: "'+w+'".');return s.basePath===!1?this._joinPath(["/",w]):this._joinPath([o._config.basePath,w])}},{key:"sendTo",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),a=1;r>a;a++)n[a-1]=arguments[a];return this._inits.then(function(){var r=t._atAddress(e),a=r._addressHandlers[e];return a.apply(r,n)})}},{key:"_registerAddress",value:function(e,t){if(this._addresses=this._addresses||(this._addresses={}),/,/.test(e))throw new Error('Addresses cannot contain a comma: "'+e+'".');if(!(t instanceof H||t instanceof R))throw new TypeError([n(this)," cannot register an address for a non-App/non-Route instance, ",n(t),"."].join(""));if(e in this._addresses)throw new Error([n(this),' address "',e,'" already taken. Could not register the address for ',n(t),"."].join(""));this._addresses[e]=t}},{key:"_atAddress",value:function(e){return this._addresses=this._addresses||(this._addresses={}),this._addresses[e]}},{key:"_getBasepathHref",value:function(){return window.location.origin+this._config.basePath}},{key:"_joinBasepathTo",value:function(e){return"/"===e[0]&&(e=e.slice(1)),this._config.basePath+e}},{key:"_splitDestination",value:function(e){var t=e.split("?"),r=f.slicedToArray(t,2),n=r[0],a=r[1],s=void 0===a?"":a;return{path:n,queryString:s}}},{key:"_getNavigationPath",value:function(e){var t=this._getBasepathHref(e);return 0===e.indexOf(t)?e.slice(t.length-1):null}},{key:"_popstate",value:function(e){var r=this._getNavigationPath(window.location.href);if(r){var n=this.navigate(r,{pushState:!1}),a=this._config.history;t(a,"Function")&&a.call(this,e,n)}}},{key:"_linksClickDelegatedHandler",value:function(e){if(0===e.button){for(var r=e.target;r&&"A"!==r.nodeName;)r=r.parentNode;if(r&&null===r.getAttribute("target")){var n=this._getNavigationPath(r.href);if(n){e.stopPropagation(),e.preventDefault();var a=this.navigate(n),s=this._config.interceptLinks;t(s,"Function")&&s.call(this,e,a)}}}}},{key:"_interceptOutletsLinks",value:function(e,t){var r=e._rootApp,n=e._mountMapper,a=n.allMounts().filter(function(e){return e instanceof H});a.forEach(function(e){return r._interceptOutletsLinks(e,t)});var s=e.outlets;Object.keys(s).forEach(function(e){var r=s[e]._element;r.addEventListener("click",t,!1)})}},{key:"start",value:function(){var e=this;this._config.windowLoad&&!function(){var r=e._getNavigationPath(window.location.href);r&&window.addEventListener("load",function(n){var a=e.navigate(r,{pushState:!1}),s=e._config.windowLoad;t(s,"Function")&&s.call(e,n,a)},!1)}(),this._config.history&&window.addEventListener("popstate",this._popstate.bind(this),!1);var r=this._linksClickDelegatedHandler.bind(this),n=this._config.interceptLinks;return t(n,"Function")&&(n=n.name),"all"===n?document.addEventListener("click",r,!1):"outlets"===n&&this._interceptOutletsLinks(this,r),this}},{key:"_parseQueryString",value:function(e){return"?"===e[0]&&(e=e.slice(1)),e.length?e.split("&").reduce(function(e,t){var r=t.split("="),n=f.slicedToArray(r,2),a=n[0],s=n[1];return s=decodeURIComponent(s),"true"===s?s=!0:"false"===s&&(s=!1),e[a]=s,e},{}):null}},{key:"_triggerNextTransition",value:function(){this._transitionQueue.length?(this._currentTransition=this._transitionQueue.shift(),this._currentTransition.start().then(this._triggerNextTransition.bind(this),this._triggerNextTransition.bind(this))):this._currentTransition=null}},{key:"navigate",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{pushState:!0}:arguments[1],r=new U(e,t,this._navigate.bind(this));return this.getCurrentTransition()?this._transitionQueue.push(r):(this._currentTransition=r,this._currentTransition.start().then(this._triggerNextTransition.bind(this),this._triggerNextTransition.bind(this))),r.promise}},{key:"_navigate",value:function(e,a){var s=this,o=this._splitDestination(e),i=o.path,u=o.queryString,c=this._parseQueryString(u),l=null,h=/\/+$/;if(this._config.stripTrailingSlash===!0&&h.test(i)&&(i=i.replace(h,"")),this._config.addTrailingSlash===!0&&(h.test(i)||(i+="/")),(r(c,"Null")||r(this._lastQueryParams,"Null"))&&(l=p(this._lastQueryParams||{},c||{})),this.fullUrl){var d=this.fullUrl.split("?"),m=f.slicedToArray(d,1),v=m[0];if(i===v&&t(l,"Null"))return Promise.resolve({sameUrl:!0})}var y=this._buildPath(i);if("404"===y.result){var g=new Error('404 for path: "'+e+'".');return g.routingTrace=y,Promise.reject(g)}if("success"===y.result)return this._constructState(y,c,l).then(function(){s._fullUrl=e,s._config.history&&(e=s._joinBasepathTo(e),a.replaceState===!0?window.history.replaceState({},"",e):a.pushState===!0&&window.history.pushState({},"",e))});throw new TypeError(n(this)+"#navigate(): routingTrace had in invalid value: "+JSON.stringify(y.result)+".")}},{key:"canNavigateTo",value:function(e){var t=this._splitDestination(e),r=t.path;return"success"===this._buildPath(r).result}},{key:"_routeFor",value:function(e){var t=this._splitDestination(e),r=t.path,n=this._buildPath(r),a=n.steps,s=a[a.length-1],o=s.app,i=s.crumb;return o._mountMapper.mountFor(i)}},{key:"_buildPath",value:function(e){for(var r=this,n=[],a=null,s=void 0,o=void 0;s=r._mountMapper.match(e);){var i=s,u=i.crumb,c=i.params,l=r._mountMapper.getCurrentMount();if(t(a,"Null")&&t(l,"String")&&u!==l&&(a={app:r,from:l,to:u}),n.push({app:r,crumb:u,params:c}),r=r._mountMapper.mountFor(u),t(s.rest,"Null")){if(r instanceof R)break;e=""}else e=s.rest}o=t(s,"Null")?"404":"success";var p={result:o,diverge:a,steps:n};return p}},{key:"_buildAppRenderDataFromMountRenderData",value:function(e,t){var r=void 0,n=void 0;if(e instanceof a)n=e._lastParams;else{var s=e._parentApp._mountMapper,o=s._crumbDataFor(e);r=o.crumb,n=s.lastParamsFor(o.crumb)}n=n||{};var i=this._buildRenderData(t.params,e.expectedParams(),n,t.diff?t.diff.queryParams:t.diff),u=i.params,c=i.diff;return{crumb:r,lastParams:n,params:u,diff:c}}},{key:"_renderStepsAs",value:function(e,t,r){var n=this;if("_prerender"!==e&&"_render"!==e)throw new Error("Tried to render a step but was not given the right render type: "+e+".");return t.reduce(function(t,s){return t.then(function(){var t=s.app,o=s.cMountsRenderData,i=s.mountData,u=i.crumb,c=i.mount,l=i.params,p=i.diff,h=n._buildAppRenderDataFromMountRenderData(t,i);return t[e](h.params,r,h.diff).then(function(){var n=Object.keys(o),s=n.reduce(function(t,n){var a=o[n];return a.forEach(function(n){var a=n.route,s=n.params,o=n.diff;t.push(a[e](s,r,o))}),t},[]);return c instanceof R&&s.push(c[e](l,r,p)),Promise.all(s).then(function(){if("_render"===e)if(t instanceof a?(t._lastParams=h.params,t._lastQueryParams=r):t instanceof H&&t._parentApp._mountMapper.setCurrentMount(h.crumb,h.params),c instanceof R&&t._mountMapper.setCurrentMount(u,l),n.length){var s=n.reduce(function(e,t){return e[t]=o[t].map(function(e){return e.params||{}}),e},{});t._conditionalMountMapper.setCurrentMounts(s)}else t._conditionalMountMapper.setCurrentMounts(null)})})})},Promise.resolve())}},{key:"_buildRenderData",value:function(e,t,r,n){var a=t.reduce(function(t,r){return t[r]=e[r],t},{}),s=p(r,a),o=h(s,n);return Object.keys(a).length||(a=null),{params:a,diff:o}}},{key:"_rebuildStepsAsRoutes",value:function(e,t){var r=this,n={};return e.map(function(e){var a=e.app,s=e.crumb,o=e.params,i=a._mountMapper,u=a._conditionalMountMapper;Object.assign(n,o);var c=i.mountFor(s),l=i.lastParamsFor(s)||{},p=r._buildRenderData(n,c.expectedParams(),l,t);p.crumb=s,p.mount=c;var h=Object.keys(u.match(i.addressesFor(s))||{}).reduce(function(e,a){var s=u.routesFor(a),o=u.lastParamsFor(a)||s.map(function(){return{}});return e[a]=s.map(function(e,a){var s=r._buildRenderData(n,e.expectedParams(),o[a],t);return s.route=e,s}),e},{});return{app:a,mountData:p,cMountsRenderData:h}})}},{key:"_flattenDeactivationData",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return t.map(function(t){return e.routesFor(t)}).reduce(function(e,t){return t.forEach(function(t){return e.push(t)}),e},[])}},{key:"_buildDeactivationSteps",value:function(e){var t=[],r=e.app,n=r._mountMapper,a=r._conditionalMountMapper,s=a.match(n.addressesFor(e.to))||{},o=Object.keys(a.match(n.addressesFor(e.from))||{}).filter(function(e){return!s[e]}),i=this._flattenDeactivationData(a,o);t.push({app:r,routesToDeactivate:i});for(var u=e.from;n.mountFor(u)instanceof H;)r=n.mountFor(u),n=r._mountMapper,a=r._conditionalMountMapper,i=this._flattenDeactivationData(a,a.getCurrentMounts()||[]),t.push({app:r,routesToDeactivate:i}),u=n.getCurrentMount();return i.push(n.mountFor(u)),t}},{key:"_deactivateDivergentBranch",value:function(e){var t=e.length-1;return e.reduceRight(function(e,r,n){var a=r.app,s=r.routesToDeactivate;return e.then(function(){var e=a._mountMapper,r=a._conditionalMountMapper,o=s.map(function(e){return e._deactivate()});return Promise.all(o).then(function(){return r.setCurrentMounts(null),n===t&&e.setCurrentMount(null),0!==n?a._deactivate():void 0})})},Promise.resolve())}},{key:"_constructState",value:function(e,t,r){var n=this,a=this._rebuildStepsAsRoutes(e.steps,r);return Promise.resolve().then(function(){return n._renderStepsAs("_prerender",a,t)}).then(function(){if(e.diverge){var t=n._buildDeactivationSteps(e.diverge);return n._deactivateDivergentBranch(t)}}).then(function(){return n._renderStepsAs("_render",a,t)})}},{key:"fullUrl",get:function(){return this._fullUrl}}]),a}(H),B=function(e){function t(){return f.classCallCheck(this,t),f.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return f.inherits(t,e),f.createClass(t,[{key:"clear",value:function(){this._element&&this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._element=null}},{key:"el",get:function(){return this._element},set:function(e){if(!(e instanceof Element))throw new TypeError(n(this)+'.el setter was not passed an "Element" instance.');this.clear(),this._element=e}},{key:"innerHTML",get:function(){if(!this._element)throw new Error(n(this)+".innerHTML was being retrieved but the outlet is not holding an element.");return this._element.innerHTML},set:function(e){if(!this._element)throw new Error(n(this)+".innerHTML was being set but the outlet is not holding an element.");this._element.innerHTML=e}}]),t}(b),Q=function(){function e(){f.classCallCheck(this,e),this._events={},this.init.apply(this,arguments)}return f.createClass(e,[{key:"init",value:function(){}},{key:"DOMListen",value:function(e,a,s,o){if(t(s,"String")&&(s=this[s],o=this),!(e instanceof Element))throw new TypeError(n(this)+"#DOMListen() was not passed an Element instance.");if(r(s,"Function"))throw new TypeError(n(this)+"#DOMListen() was not passed a callback that was a function type.");var i=this._events[a]||(this._events[a]=[]),u=i.find(function(t){var r=f.slicedToArray(t,1),n=r[0];return e===n});u||(u=[e,[]],i.push(u));var c=u,l=f.slicedToArray(c,2),p=l[1],h=p.some(function(e){return e.callback===s&&e.context===o});if(!h){var d={callback:s,context:o,boundCallback:s.bind(o)};p.push(d),e.addEventListener(a,d.boundCallback,!1)}}},{key:"DOMUnlisten",value:function(e,r,a,s){if(t(a,"String")&&(a=this[a],s=this),!(e instanceof Element))throw new TypeError(n(this)+"#DOMUnlisten() was not passed an Element instance.");var o=this._events[r]||(this._events[r]=[]),i=o.findIndex(function(t){var r=f.slicedToArray(t,1),n=r[0];return e===n});if(-1!==i){var u=o[i],c=f.slicedToArray(u,2),l=c[1];if(a){var p=l.findIndex(function(e){return e.callback===a&&e.context===s});-1!==p&&(e.removeEventListener(r,l[p].boundCallback,!1),l.splice(p,1))}else l.forEach(function(t){return e.removeEventListener(r,t.boundCallback,!1)}),l.length=0;0===l.length&&o.splice(i,1)}}}]),e}();"function"!=typeof Object.assign&&!function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])}return t}}();var z={RootApp:q,App:H,Route:R,Outlet:b,MutableOutlet:B,View:Q,makeOutlet:d};e.RootApp=q,e.App=H,e.Route=R,e.Outlet=b,e.MutableOutlet=B,e.View=Q,e.makeOutlet=d,e["default"]=z}(this.Ether=this.Ether||{});